---
format: html
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| message: false
#| warning: false

library(tidyverse)
library(gt)
library(gtExtras)
library(gtUtils)

# read in practice data for September 23, 2025
practice_0923 <- read_csv("practice_stats_2025_09_23.csv")

# read in practice data for September 24, 2025
practice_0924 <- read_csv("practice_stats_2025_09_24.csv")

# read in practice data for September 25, 2025
practice_0925 <- read_csv("practice_stats_2025_09_25.csv")

# read in practice data for September 26, 2025
practice_0926 <- read_csv("practice_stats_2025_09_26.csv")

# combine the data from different practices
practice_totals <- bind_rows(practice_0923, practice_0924, practice_0925, practice_0926) 

# get summary data from practices
practice_totals <- practice_totals |> 
  group_by(Name) |> 
  summarise(
    Name = first(Name), 
    Number = first(Number), 
    FG2 = sum(FG2), 
    FGA2 = sum(FGA2), 
    FG3 = sum(FG3), 
    FGA3 = sum(FGA3), 
    DREB = sum(DREB), 
    OREB = sum(OREB),
    AST = sum(AST), 
    STL = sum(STL),
    TO = sum(TO),
    FT = sum(FT), 
    FTA = sum(FTA)
  ) |> 
  ungroup() |> 
  arrange(Number)

# add additional statistics
practice_totals <- practice_totals |> 
  mutate(PTS = 2*FG2 + 3*FG3 + FT, 
         FG = FG2 + FG3, 
         FGA = FGA2 + FGA3, 
         FG2_per = FG2/FGA2, 
         FG3_per = FG3/FGA3, 
         FG_per = FG/FGA,
         EFG_per = (FG2 + 1.5*FG3)/ FGA, 
         REB = DREB + OREB, 
         AST_TO_ratio = AST/TO)



# add player headshot urls to data
#practice_totals <- practice_totals |> 
 # mutate(Headshot = ifelse(Name == "Devyn Quigley", "NCSU player headshots/Devyn_Quigley_headshot.png", ifelse(Name == "Lorena Awou", "NCSU player headshots/Lorena_Awou_headshot.png", ifelse(Name == "Qadence Samuels", "NCSU player headshots/Qadence_Samuels_headshot.png", ifelse(Name == "Zamareya Jones", "NCSU player headshots/Zamareya_Jones_headshot.png", ifelse(Name == "Ky’She Lunan", "NCSU player headshots/KyShe_Lunan_headshot.png", ifelse(Name == "Adelaide Jernigan", "NCSU player headshots/Adelaide_Jernigan_headshot.png", ifelse(Name == "Maddie Cox", "NCSU player headshots/Maddie_Cox_headshot.png", ifelse(Name == "Khamil Pierre", "NCSU player headshots/Khamil_Pierre_headshot.png", ifelse(Name == "Tilda Trygger", "NCSU player headshots/Tilda_Trygger_headshot.png", ifelse(Name == "Zoe Brooks", "NCSU player headshots/Zoe_Brooks_headshot.png", ifelse(Name == "Mallory Collier", "NCSU player headshots/Mallory_Collier_headshot.png", ""))))))))))))


practice_totals <- practice_totals |> 
  mutate(Headshot = case_when(
  Name == "Devyn Quigley" ~ "NCSU player headshots/Devyn_Quigley_headshot.png",
  Name == "Lorena Awou"   ~ "NCSU player headshots/Lorena_Awou_headshot.png",
  Name == "Qadence Samuels" ~ "NCSU player headshots/Qadence_Samuels_headshot.png",
  Name == "Zamareya Jones"  ~ "NCSU player headshots/Zamareya_Jones_headshot.png",
  Name == "Ky’She Lunan"    ~ "NCSU player headshots/KyShe_Lunan_headshot.png",
  Name == "Adelaide Jernigan" ~ "NCSU player headshots/Adelaide_Jernigan_headshot.png",
  Name == "Maddie Cox"      ~ "NCSU player headshots/Maddie_Cox_headshot.png",
  Name == "Khamil Pierre"   ~ "NCSU player headshots/Khamil_Pierre_headshot.png",
  Name == "Tilda Trygger"   ~ "NCSU player headshots/Tilda_Trygger_headshot.png",
  Name == "Zoe Brooks"      ~ "NCSU player headshots/Zoe_Brooks_headshot.png",
  Name == "Mallory Collier" ~ "NCSU player headshots/Mallory_Collier_headshot.png",
  TRUE ~ NA
))

practice_totals <- practice_totals |> 
  mutate(across(where(is.numeric), ~replace(., is.na(.), 0)))

# calculate totals for the entire team
team_practice_totals <- practice_totals |> 
  summarise(
    Number = "", 
    Name = "Team Totals", 
    FG2 = sum(FG2, na.rm = TRUE), 
    FGA2 = sum(FGA2, na.rm = TRUE), 
    FG3 = sum(FG3, na.rm = TRUE), 
    FGA3 = sum(FGA3, na.rm = TRUE), 
    DREB = sum(DREB, na.rm = TRUE), 
    OREB = sum(OREB, na.rm = TRUE), 
    AST = sum(AST, na.rm = TRUE), 
    STL = sum(STL, na.rm = TRUE), 
    TO = sum(TO, na.rm = TRUE), 
    FT = sum(FT, na.rm = TRUE), 
    FTA = sum(FTA, na.rm = TRUE), 
    PTS = sum(PTS, na.rm = TRUE), 
    FG = sum(FG, na.rm = TRUE), 
    FGA = sum(FGA, na.rm = TRUE), 
    FG2_per = FG2 / FGA2, 
    FG3_per = FG3 / FGA3, 
    FG_per = FG / FGA, 
    EFG_per = (FG + 0.5 * FG3) / FGA, 
    REB = sum(REB, na.rm = TRUE), 
    AST_TO_ratio = AST / TO, 
    Headshot = "NCSU player headshots/NCSU_logo.png"
  )


# add the team totals to the player stats
practice_totals_with_team <- bind_rows(
  practice_totals|> 
    mutate(Number = as.character(Number)), 
  team_practice_totals
  )

#Create the table theme used in the F5 (https://thef5.substack.com/p/how-to-positional-matchup-tables)
#This theme has been slightly altered to fit NC State
gt_theme_ncsu <- function(gt_object, ...) {
  gt_object %>%
    opt_table_font(
      font = list(
        google_font("Roboto"),
        default_fonts()
      ),
      weight = 400
    ) %>%
    tab_style(
      locations = cells_title("title"),
      style = cell_text(
        font = "Impact",
        weight = 700,
        color = "#CC0000"
      )
    ) %>%
    tab_style(
      locations = cells_title("subtitle"),
      style = cell_text(
        font = "Impact",
        color = "black",
        weight = 400
      )
    ) %>%
    tab_style(
      style = list(
        cell_borders(
          sides = "top", color = "black", weight = px(0)
        ),
        cell_text(
          font = google_font("Roboto"),
          #transform = "uppercase",
          v_align = "bottom",
          size = px(14),
          weight = 'bold'
        )
      ),
      locations = list(
        gt::cells_column_labels(),
        gt::cells_stubhead()
      )
    ) %>%
    tab_options(
      column_labels.background.color = "white",
      data_row.padding = px(7.5),
      heading.border.bottom.style = "none",
      table.border.top.style = "none", # transparent
      table.border.bottom.style = "none",
      column_labels.font.weight = "bold", 
      column_labels.border.top.style = "none",
      column_labels.border.bottom.width = px(2),
      column_labels.border.bottom.color = "black",
      row_group.border.top.style = "none",
      row_group.border.top.color = "black",
      row_group.border.bottom.width = px(1),
      row_group.border.bottom.color = "white",
      stub.border.color = "white",
      stub.border.width = px(0),
      source_notes.font.size = 12,
      source_notes.border.lr.style = "none",
      table.font.size = 16,
      heading.title.font.size = 36, #personally make the title font larger
      heading.subtitle.font.size = 18, #personally set the subtitle font size
      heading.align = "left",
      table.background.color = "white",
      table_body.hlines.color = 'black',
      ...
    )
}

#Save the url to a png of NC State's Logo as an object
ncsuLogo.png <- "https://a.espncdn.com/combiner/i?img=/i/teamlogos/ncaa/500/152.png&h=200&w=200" 

# create table
practice_totals_with_team |> 
  select(Headshot, Number, Name, FG, FGA, FG_per, FG3, FGA3, FG3_per, EFG_per, REB, OREB, AST, STL, TO, AST_TO_ratio) |> 
  mutate(
    FG_per = round(FG_per, 3), 
    FG3_per = round(FG3_per, 3), 
    EFG_per = round(EFG_per, 3), 
    AST_TO_ratio = round(AST_TO_ratio, 3), 
  ) |> 
  # turn into a nice gt table
  gt() |> 
  # add in headshot images
  gt_img_rows(columns = "Headshot", img_source = "local", height = 80) |> 
  # format column names
  cols_label(
    Headshot = "", 
    Number = "", 
    FG_per = "FG%", 
    FG3 = "3FG", 
    FGA3 = "3FGA", 
    FG3_per = "3FG%", 
    EFG_per = "EFG%",
    REB = "TREB",
    AST_TO_ratio = html("AST/<br>TO")
  ) |> 
  # add title/subtitle
  tab_header(html(
    web_image(
      url = ncsuLogo.png,
      height = px(40)), 
    "<span style='font-size:32px;'>2025-26 Player Practice Stats</span>"), # need to use this format to increase title font size
    subtitle =  "Through Sep. 26, 2025") |> 
  # add theme, this is one similar to the one used by the NCAA (makes all column names uppercase)
  gt_theme_ncaa() |> 
  # make the Team Totals row at the bottom have a black background and white text
  tab_style(style = list(cell_text(color = "#FFFFFF"),
                         cell_fill(color = "#000000")),
            locations = cells_body(rows = Name == "Team Totals")) |> 
  # make sure the AST/TO column isn't cut off
  cols_width(
    AST_TO_ratio ~ px(60)   # adjust px value until it fits
  )
```
